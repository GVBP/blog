<html>
<head>
	<title>Lista de Posts</title>
	<link rel="stylesheet" href="../estilo.css">

	<script>
		function loadPosts() {
			var xhttp = new XMLHttpRequest();

			
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var posts = JSON.parse(this.responseText); // var 'posts' recebe todo o arquivo JSON
					var postsHtml = document.getElementById('posts'); // var 'postsHtml' recebe todo o conteúdo do elemento 'posts';
					var imagens = loadImages(); // var 'imagens' recebe todas as imagens da função 'loadImages()'

					
					for (var i = 0; i < posts.length; i++) {
						var post = posts[i]; 
						var dtHtml = document.createElement('dt');
						var index = Math.floor((Math.random() * 100) + 1);
						
						/*
						var repit = [];
						// Erro de repitções nas fotos;
						for (var x = 0; x < posts.length; ) {
							if () {

							}
						}
						*/


						dtHtml.innerHTML =  "<img src='" + imagens[index] + "' style='width: 32px; height: 32px;'></img>";//"Usuário: " + post.id;
						postsHtml.appendChild(dtHtml);
						var ddHtml = document.createElement('dd');
						ddHtml.innerHTML = "Título: " + post.title + "." + "</br></br>" + "Comentários: " + post.body + ".";
						postsHtml.appendChild(ddHtml);
					}
					
				}				
			};
			
			xhttp.open("GET", "https://jsonplaceholder.typicode.com/posts", false);
			xhttp.setRequestHeader("Content-type", "application/json");
			xhttp.send();
		}

		function loadImages() {
			var xhttp = new XMLHttpRequest();
			var images = [];
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var users = JSON.parse(this.responseText).results;
					for (var i = 0; i < users.length; i++) {
						images.push(users[i].picture.large);
					}
				}
			};
			xhttp.open("GET", "https://randomuser.me/api/?results=100", false);
			xhttp.setRequestHeader("Content-type", "application/json");
			xhttp.send();

			return images;			
		}
	</script>
</head>
<body onload="loadPosts()">
	<dl id="posts"></dl>
</body>
</html>